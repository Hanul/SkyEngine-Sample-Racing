SkyEngine.CreateGradient=METHOD({run:e=>{let n,t=e.type,i=e.startX,o=e.startY,a=e.startRadius,c=e.endX,r=e.endY,l=e.endRadius,g=e.colors;return n="radial"===t?SkyEngine.Screen.getCanvasContext().createRadialGradient(i,o,a,c,r,l):SkyEngine.Screen.getCanvasContext().createLinearGradient(i,o,c,r),EACH(g,(e,t)=>{n.addColorStop(t/(g.length-1),e)}),n}}),SkyEngine.Delay=CLASS(e=>{let n=[];e.step=(e=>{for(let t=0;t<n.length;t+=1)n[t].step(e)});return{init:(e,t,i,o)=>{void 0===o&&(o=i,i=0);let a=0,c=(t.resume=RAR(()=>{CHECK_IS_IN({array:n,value:t})!==!0&&n.push(t)}),t.pause=(()=>{REMOVE({array:n,value:t})})),r=t.remove=(()=>{c()});t.step=(e=>{a+=e,a>=i&&(o(),r())})}}}),SkyEngine.E=CLASS({preset:()=>{return E},init:(e,n,t)=>{n.stopDefault=(()=>{t.stopDefault()}),n.stopBubbling=(()=>{t.stopBubbling()}),n.checkIsBubblingStoped=(()=>{return t.checkIsBubblingStoped()}),n.stop=(()=>{t.stop()}),n.getX=(()=>{return(t.getLeft()-WIN_WIDTH()/2)/SkyEngine.Screen.getRatio()}),n.getY=(()=>{return(t.getTop()-WIN_HEIGHT()/2)/SkyEngine.Screen.getRatio()}),n.getKey=(()=>{return t.getKey()}),n.getWheelDelta=(()=>{return t.getWheelDelta()})}}),SkyEngine.Interval=CLASS(e=>{let n=[];e.step=(e=>{for(let t=0;t<n.length;t+=1)n[t].step(e)});return{init:(e,t,i,o)=>{void 0===o&&(o=i,i=0);let a=0,c=0,r=(t.resume=RAR(()=>{CHECK_IS_IN({array:n,value:t})!==!0&&n.push(t)}),t.pause=(()=>{REMOVE({array:n,value:t})})),l=t.remove=(()=>{r()});t.step=(e=>{a+=e,a>=i&&(a-=i,c+=1,o(t,c)===!1&&l())})}}}),SkyEngine.Node=CLASS({init:(e,n,t)=>{let i,o,a,c,r,l,g,d,f,u,S,s,v,p,R,h,E,y,k,m,C,x,w,Y,I,X,D,A,T,P,O,M,H,F,W,L,N,V,_,b,B,U,G,K,q,z,Z,J,j,Q,$,ee,ne,te,ie,oe,ae,ce,re,le,ge,de,fe,ue,Se,se,ve,pe,Re,he=[],Ee=!1,ye=!1,ke={},me=[],Ce=[],xe=[],we={},Ye={},Ie={},Xe=0,De=()=>{if(void 0===le)b=i,B=o,U=i,G=o;else{let e=i*le.getRealScaleX(),n=o*le.getRealScaleY();b=le.getDrawingX()+e*le.getRealCos()-n*le.getRealSin(),B=le.getDrawingY()+e*le.getRealSin()+n*le.getRealCos();let t=c*K,a=r*q;U=b-t*J+a*Z,G=B-t*Z-a*J}},Ae=n.setX=(e=>{i=e,De()}),Te=(n.getX=(()=>{return i}),n.setY=(e=>{o=e,De()})),Pe=(n.getY=(()=>{return o}),n.setZIndex=(e=>{void 0!==re&&(qe(),a=e,ze())})),Oe=(n.getZIndex=(()=>{return a}),n.setPosition=(e=>{void 0!==e.x&&(i=e.x),void 0!==e.y&&(o=e.y),void 0===e.x&&void 0===e.y||De(),void 0!==e.zIndex&&Pe(e.zIndex)}),n.setCenterX=(e=>{c=e}),n.getCenterX=(()=>{return c}),n.setCenterY=(e=>{r=e}),n.getCenterY=(()=>{return r}),n.setSpeedX=(e=>{u=e}),n.getSpeedX=(()=>{return u}),n.setSpeedY=(e=>{S=e}),n.getSpeedY=(()=>{return S}),n.setAccelX=(e=>{h=e}),n.getAccelX=(()=>{return h}),n.setAccelY=(e=>{E=e}),n.getAccelY=(()=>{return E}),n.setMinSpeedX=(e=>{x=e}),n.getMinSpeedX=(()=>{return x}),n.setMinSpeedY=(e=>{w=e}),n.getMinSpeedY=(()=>{return w}),n.setMaxSpeedX=(e=>{A=e}),n.getMaxSpeedX=(()=>{return A}),n.setMaxSpeedY=(e=>{T=e}),n.getMaxSpeedY=(()=>{return T}),n.setToX=(e=>{F=e}),n.getToX=(()=>{return F}),n.setToY=(e=>{W=e}),n.getToY=(()=>{return W}),n.setScaleX=(e=>{l=e,K=void 0===le?l:le.getRealScaleX()*l})),Me=(n.getScaleX=(()=>{return l}),n.setScaleY=(e=>{g=e,q=void 0===le?e:le.getRealScaleY()*g})),He=(n.getScaleY=(()=>{return g}),n.setScale=(e=>{Oe(e),Me(e)})),Fe=(n.setScalingSpeedX=(e=>{s=e}),n.getScalingSpeedX=(()=>{return s}),n.setScalingSpeedY=(e=>{v=e}),n.getScalingSpeedY=(()=>{return v}),n.setScalingSpeed=(e=>{s=e,v=e})),We=(n.setScalingAccelX=(e=>{y=e}),n.getScalingAccelX=(()=>{return y}),n.setScalingAccelY=(e=>{k=e}),n.getScalingAccelY=(()=>{return k}),n.setScalingAccel=(e=>{y=e,k=e})),Le=(n.setMinScalingSpeedX=(e=>{Y=e}),n.getMinScalingSpeedX=(()=>{return Y}),n.setMinScalingSpeedY=(e=>{I=e}),n.getMinScalingSpeedY=(()=>{return I}),n.setMinScalingSpeed=(e=>{Y=e,I=e}),n.setMaxScalingSpeedX=(e=>{P=e}),n.getMaxScalingSpeedX=(()=>{return P}),n.setMaxScalingSpeedY=(e=>{O=e}),n.getMaxScalingSpeedY=(()=>{return O}),n.setMaxScalingSpeed=(e=>{P=e,O=e}),n.setToScaleX=(e=>{L=e}),n.getToScaleX=(()=>{return L}),n.setToScaleY=(e=>{N=e}),n.getToScaleY=(()=>{return N}),n.setToScale=(e=>{L=e,N=e})),Ne=n.setAngle=(e=>{d=e,z=void 0===le?d*Math.PI/180:le.getRealRadian()+d*Math.PI/180,Z=Math.sin(z),J=Math.cos(z)}),Ve=(n.getAngle=(()=>{return d}),n.setRotationSpeed=(e=>{p=e}),n.getRotationSpeed=(()=>{return p}),n.setRotationAccel=(e=>{m=e}),n.getRotationAccel=(()=>{return m}),n.setMinRotationSpeed=(e=>{X=e}),n.getMinRotationSpeed=(()=>{return X}),n.setMaxRotationSpeed=(e=>{M=e}),n.getMaxRotationSpeed=(()=>{return M}),n.setToAngle=(e=>{V=e}),n.getToAngle=(()=>{return V}),n.setAlpha=(e=>{f=e}),n.getAlpha=(()=>{return f}),n.setFadingSpeed=(e=>{R=e}),n.getFadingSpeed=(()=>{return R}),n.setFadingAccel=(e=>{C=e}),n.getFadingAccel=(()=>{return C}),n.setMinFadingSpeed=(e=>{D=e}),n.getMinFadingSpeed=(()=>{return D}),n.setMaxFadingSpeed=(e=>{H=e}),n.getMaxFadingSpeed=(()=>{return H}),n.setToAlpha=(e=>{_=e}),n.getToAlpha=(()=>{return _}),n.getDrawingX=(()=>{return U}),n.getDrawingY=(()=>{return G}),n.getRealX=(()=>{return b}),n.getRealY=(()=>{return B}),n.getRealScaleX=(()=>{return K}),n.getRealScaleY=(()=>{return q}),n.getRealRadian=(()=>{return z}),n.getRealSin=(()=>{return Z}),n.getRealCos=(()=>{return J}),n.getBeforeX=(()=>{return j}),n.getBeforeY=(()=>{return Q}),()=>{Ne(d),Oe(l),Me(g),De()});void 0!==t&&(i=t.x,o=t.y,c=t.centerX,r=t.centerY,a=t.zIndex,void 0!==t.scale&&He(t.scale),void 0!==t.scaleX&&(l=t.scaleX),void 0!==t.scaleY&&(g=t.scaleY),d=t.angle,f=t.alpha,u=t.speedX,S=t.speedY,void 0!==t.scalingSpeed&&Fe(t.scalingSpeed),void 0!==t.scalingSpeedX&&(s=t.scalingSpeedX),void 0!==t.scalingSpeedY&&(v=t.scalingSpeedY),p=t.rotationSpeed,R=t.fadingSpeed,h=t.accelX,E=t.accelY,void 0!==t.scalingAccel&&We(t.scalingAccel),void 0!==t.scalingAccelX&&(y=t.scalingAccelX),void 0!==t.scalingAccelY&&(k=t.scalingAccelY),m=t.rotationAccel,C=t.fadingAccel,x=t.minSpeedX,w=t.minSpeedY,void 0!==t.minScaleSpeed&&setMinScaleSpeed(t.minScaleSpeed),void 0!==t.minScaleSpeedX&&(minScaleSpeedX=t.minScaleSpeedX),void 0!==t.minScaleSpeedY&&(minScaleSpeedY=t.minScaleSpeedY),X=t.minRotationSpeed,D=t.minFadingSpeed,A=t.maxSpeedX,T=t.maxSpeedY,void 0!==t.maxScaleSpeed&&setMaxScaleSpeed(t.maxScaleSpeed),void 0!==t.maxScaleSpeedX&&(maxScaleSpeedX=t.maxScaleSpeedX),void 0!==t.maxScaleSpeedY&&(maxScaleSpeedY=t.maxScaleSpeedY),M=t.maxRotationSpeed,H=t.maxFadingSpeed,F=t.toX,W=t.toY,void 0!==t.toScale&&Le(t.toScale),void 0!==t.toScaleX&&(L=t.toScaleX),void 0!==t.toScaleY&&(N=t.toScaleY),V=t.toAngle,_=t.toAlpha,void 0!==t.isHiding&&(Ee=t.isHiding),ge=t.filter,de=t.blendMode,pe=t.onDisplayResize),void 0===i&&(i=0),void 0===o&&(o=0),void 0===c&&(c=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===u&&(u=0),void 0===S&&(S=0),void 0===h&&(h=0),void 0===E&&(E=0),void 0===l&&(l=1),void 0===g&&(g=1),void 0===s&&(s=0),void 0===v&&(v=0),void 0===y&&(y=0),void 0===k&&(k=0),void 0===d&&(d=0),void 0===p&&(p=0),void 0===m&&(m=0),void 0===f&&(f=1),void 0===R&&(R=0),void 0===C&&(C=0),void 0!==pe&&(Re=EVENT("resize",RAR(()=>{let e=pe();void 0!==e.x&&Ae(e.x),void 0!==e.y&&Te(e.y),void 0!==e.scaleX&&Oe(e.scaleX),void 0!==e.scaleY&&Me(e.scaleY)}))),SkyEngine.Screen!==n&&SkyEngine.Screen.registerNode(n);let _e=(n.setFilter=(e=>{ge=e}),n.getFilter=(()=>{return ge}),n.removeFilter=(()=>{ge=void 0}),n.setBlendMode=(e=>{de=e}),n.getBlendMode=(()=>{return de}),n.removeBlendMode=(()=>{de=void 0}),n.moveLeft=((e,n)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(u=-e.speed),h=void 0===e.accel?0:-e.accel,A=0,x=void 0!==e.maxSpeed?-e.maxSpeed:void 0,void 0!==e.toX&&(F=e.toX,ee=n)):(h=0,u=x=-e)})),be=(n.stopLeft=(e=>{void 0!==e?(h=e,A=0):u<0&&(h<0&&(h=0),u=0)}),n.moveRight=((e,n)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(u=e.speed),h=void 0===e.accel?0:e.accel,x=0,A=void 0!==e.maxSpeed?e.maxSpeed:void 0,void 0!==e.toX&&(F=e.toX,ee=n)):(h=0,u=A=e)})),Be=(n.stopRight=(e=>{void 0!==e?(h=-e,x=0):u>0&&(h>0&&(h=0),u=0)}),n.moveUp=((e,n)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=-e.speed),E=void 0===e.accel?0:-e.accel,T=0,w=void 0!==e.maxSpeed?-e.maxSpeed:void 0,void 0!==e.toY&&(W=e.toY,ne=n)):(E=0,S=w=-e)})),Ue=(n.stopUp=(e=>{void 0!==e?(E=e,T=0):S<0&&(E<0&&(E=0),S=0)}),n.moveDown=((e,n)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=e.speed),E=void 0===e.accel?0:e.accel,w=0,T=void 0!==e.maxSpeed?e.maxSpeed:void 0,void 0!==e.toY&&(W=e.toY,ne=n)):(E=0,S=T=e)})),Ge=(n.stopDown=(e=>{void 0!==e?(E=-e,w=0):S>0&&(E>0&&(E=0),S=0)}),n.moveTo=((e,n)=>{if(void 0===e.y)F=e.x,F<i?_e(e,n):be(e,n);else if(void 0===e.x)W=e.y,W<o?Be(e,n):Ue(e,n);else{F=e.x,W=e.y;let t=F-i,a=W-o,c=Math.sqrt(t*t+a*a);void 0!==e.speed&&(u=e.speed*t/c,S=e.speed*a/c),void 0!==e.accel&&(h=e.accel*t/c,E=e.accel*a/c),void 0!==e.maxSpeed&&(F<i?x=-e.maxSpeed*t/c:A=e.maxSpeed*t/c,W<o?w=-e.maxSpeed*a/c:T=e.maxSpeed*a/c),$=n}}),n.scaleTo=((e,n)=>{let t=e.speed,i=e.accel,o=(e.minSpeed,e.maxSpeed);void 0===e.y?(L=e.x,L<l?(void 0!==t&&(s=-t),void 0!==i&&(y=-i),void 0!==o&&(Y=-o)):(void 0!==t&&(s=t),void 0!==i&&(y=i),void 0!==o&&(P=o)),ie=n):void 0===e.x?(N=e.y,N<g?(void 0!==t&&(v=-t),void 0!==i&&(k=-i),void 0!==o&&(I=-o)):(void 0!==t&&(v=t),void 0!==i&&(k=i),void 0!==o&&(O=o)),oe=n):(L=e.x,L<l?(void 0!==t&&(s=-t),void 0!==i&&(y=-i),void 0!==o&&(Y=-o)):(void 0!==t&&(s=t),void 0!==i&&(y=i),void 0!==o&&(P=o)),N=e.y,N<g?(void 0!==t&&(v=-t),void 0!==i&&(k=-i),void 0!==o&&(I=-o)):(void 0!==t&&(v=t),void 0!==i&&(k=i),void 0!==o&&(O=o)),te=n)}),n.stuckLeft=(()=>{fe=!0}),n.unstuckLeft=(()=>{fe=!1}),n.stuckRight=(()=>{ue=!0}),n.unstuckRight=(()=>{ue=!1}),n.stuckUp=(()=>{Se=!0}),n.unstuckUp=(()=>{Se=!1}),n.stuckDown=(()=>{se=!0}),n.unstuckDown=(()=>{se=!1}),n.rotate=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(p=e.speed),void 0!==e.accel&&(m=e.accel),void 0!==e.minSpeed&&(X=e.minSpeed),void 0!==e.maxSpeed&&(M=e.maxSpeed)):p=e}),n.stopRotation=(e=>{void 0!==e?(m=-e,e>0?X=0:e<0&&(M=0)):p>0&&(p=0)}),n.rotateTo=((e,n)=>{V=e.toAngle,void 0!==e.speed&&(p=e.speed),void 0!==e.accel&&(m=e.accel),void 0!==e.minSpeed&&(X=e.minSpeed),void 0!==e.maxSpeed&&(M=e.maxSpeed),ae=n}),n.flipX=(()=>{l=-l}),n.flipY=(()=>{g=-g}),n.fadeIn=((e,n)=>{_=1,CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(R=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.maxSpeed&&(H=e.maxSpeed)):R=e,ce=n}),n.fadeOut=((e,n)=>{_=0,CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(R=-e.speed),void 0!==e.accel&&(C=-e.accel),void 0!==e.maxSpeed&&(D=-e.maxSpeed)):R=-e,ce=n}),n.stopFading=(e=>{void 0!==e?(C=-e,e>0?D=0:e<0&&(H=0)):R>0&&(R=0)}),n.fadeTo=((e,n)=>{_=e.toAlpha,void 0!==e.speed&&(R=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.minSpeed&&(D=e.minSpeed),void 0!==e.maxSpeed&&(H=e.maxSpeed),ce=n}),n.hide=(()=>{Ee=!0,void 0!==ve&&ve.hide()}),n.show=(()=>{Ee=!1,void 0!==ve&&ve.show()}),n.checkIsHiding=(()=>{return Ee}),n.checkIsShowing=(()=>{return Ee!==!0}),n.getChildren=(()=>{return he}),n.getParent=(()=>{return re}),n.setTarget=(e=>{if(le=e,ye!==!0&&void 0!==le){Ve();for(let e=0;e<Ce.length;e+=1)Ce[e].setTarget(n);for(let e=0;e<me.length;e+=1)me[e].setTarget(n);for(let e=0;e<he.length;e+=1)he[e].setTarget(n)}})),Ke=n.setParent=(e=>{re=e,Ge(re)}),qe=()=>{let e=re.getChildren(),t=0,i=e.length-1,o=0;for(;t<=i;){let c=Math.ceil((t+i)/2),r=e[c];if(r.getZIndex()<a)t=c+1;else{if(!(r.getZIndex()>a)){for(;;){if(e[c-o]===n){e.splice(c-o,1);break}if(o>0&&e[c+o]===n){e.splice(c+o,1);break}if(e[c-o].getZIndex()!==a&&e[c+o].getZIndex()!==a)break;o+=1}break}i=c-1}}},ze=()=>{let e=re.getChildren(),t=0,i=e.length;for(;t<i;){let n=t+i>>>1;e[n].getZIndex()<=a?t=n+1:i=n}e.splice(t,0,n)},Ze=(n.appendTo=(e=>{return void 0!==re&&qe(),Ke(e),ze(),n}),n.append=(e=>{e.appendTo(n)}),n.empty=(()=>{for(let e=0;e<he.length;e+=1){let n=he[e];n.setParent(void 0),n.remove()}he=[]}));n.remove=(()=>{je("remove"),Ze(),he=void 0,void 0!==re&&(qe(),Ke(void 0)),SkyEngine.Screen!==n&&SkyEngine.Screen.unregisterNode(n),ke=void 0;for(let e=0;e<Ce.length;e+=1)Ce[e].remove();Ce=void 0;for(let e=0;e<me.length;e+=1)me[e].remove();me=void 0,xe=void 0,we=void 0,Ye=void 0,Ie=void 0,void 0!==ve&&ve.remove(),ye=!0,void 0!==Re&&(Re.remove(),Re=void 0)}),n.checkIsRemoved=(()=>{return ye}),n.addDom=(e=>{void 0===ve&&(ve=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),ve.append(e)});e.getDomWrapper=(()=>{return ve});let Je=(n.getDomWrapper=(()=>{return void 0===ve&&(ve=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),ve}),n.addDomStyle=(e=>{void 0===ve&&(ve=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),ve.addStyle(e)}),n.removeAllDoms=(()=>{void 0!==ve&&ve.empty()}),n.on=((e,t)=>{ye===!0?"remove"===e&&t(EMPTY_E(),n):(void 0===ke[e]&&(ke[e]=[]),ke[e].push(t))}),n.checkIsEventExists=(e=>{return void 0!==ke[e]}),n.off=((e,n)=>{ye!==!0&&void 0!==ke[e]&&(void 0!==n&&REMOVE({array:ke[e],value:n}),void 0!==n&&0!==ke[e].length||delete ke[e])})),je=n.fireEvent=(e=>{let t,i;CHECK_IS_DATA(e)!==!0?t=e:(t=e.eventName,i=e.e);let o=ke[t];if(void 0!==o)for(let a=0;a<o.length;a+=1)o[a](void 0===i?EMPTY_E():i,n)}),Qe=(n.onMeet=((e,n)=>{xe.push(e),void 0===Ye[e.id]&&(Ye[e.id]=[]),Ye[e.id].push(n),en()}),n.offMeet=((e,n)=>{void 0===n?delete Ye[e.id]:REMOVE({array:Ye[e.id],value:n})}),n.runMeetHandlers=((e,n)=>{let t=Ye[e.id];if(void 0!==t)for(let i=0;i<t.length;i+=1)t[i](n)})),$e=(n.onPart=((e,n)=>{xe.push(e),void 0===Ie[e.id]&&(Ie[e.id]=[]),Ie[e.id].push(n)}),n.offPart=((e,n)=>{void 0===n?delete Ie[e.id]:REMOVE({array:Ie[e.id],value:n})}),n.runPartHandlers=((e,n)=>{let t=Ie[e.id];if(void 0!==t)for(let i=0;i<t.length;i+=1)t[i](n)})),en=(n.addTouchArea=(e=>{Ce.push(e),e.setTarget(n),e.on("remove",()=>{REMOVE({array:Ce,value:e})})}),n.getTouchAreas=(()=>{return Ce}),n.getTouchArea=(()=>{return Ce[0]}),n.addCollider=(e=>{me.push(e),e.setTarget(n),e.on("remove",()=>{REMOVE({array:me,value:e})})}),n.getColliders=(()=>{return me}),n.getCollider=(()=>{return me[0]}),n.checkPoint=((e,n)=>{for(let t=0;t<he.length;t+=1)if(he[t].checkPoint(e,n)===!0)return!0;return!1}),n.checkArea=(e=>{for(let n=0;n<he.length;n+=1){let t=he[n];if(t.checkArea(e)===!0||e.checkArea(t)===!0)return!0}return!1}),n.checkTouch=((e,t)=>{if(ye===!0||n.checkIsHiding()===!0)return!1;for(let i=0;i<Ce.length;i+=1)if(Ce[i].checkPoint(e,t)===!0)return!0;for(let i=0;i<he.length;i+=1)if(he[i].checkTouch(e,t)===!0)return!0;return!1}),n.checkOneSideCollision=(e=>{if(ye===!0||n.checkIsHiding()===!0)return!1;if(e.type===CLASS){let t=SkyEngine.Screen.getRegisteredNodes(e);for(let i=0;i<t.length;i+=1){let e=t[i];if(e!==n&&n.checkOneSideCollision(e)===!0)return!0}}else{if(e.checkIsHiding()===!0)return!1;for(let n=0;n<me.length;n+=1)if(e.checkIsRemoved()!==!0){let t=me[n],i=e.getColliders();for(let o=0;o<i.length;o+=1){let e=i[o];if(t.checkArea(e)===!0||e.checkArea(t)===!0)return!0}}for(let n=0;n<he.length;n+=1)if(he[n].checkOneSideCollision(e)===!0)return!0}return!1}),n.checkCollision=(e=>{if(e.type===CLASS){let t=SkyEngine.Screen.getRegisteredNodes(e);for(let i=0;i<t.length;i+=1){let e=t[i];if(e!==n&&e.checkIsRemoved()!==!0&&(n.checkOneSideCollision(e)===!0||n.type!==e.type&&e.checkOneSideCollision(n)===!0))return!0}}else if(e.checkIsRemoved()!==!0&&(n.checkOneSideCollision(e)===!0||n.type!==e.type&&e.checkOneSideCollision(n)===!0))return!0;return!1}),n.checkOffScreen=(()=>{for(let e=0;e<he.length;e+=1)if(he[e].checkOffScreen()!==!0)return!1;return!0}),()=>{for(let e=0;e<xe.length;e+=1){let t=xe[e];if(t.type===CLASS){let e=SkyEngine.Screen.getRegisteredNodes(t);for(let i=0;i<e.length;i+=1){let o=e[i];o!==n&&(o.checkIsRemoved()!==!0?n.checkOneSideCollision(o)===!0||n.type!==o.type&&o.checkOneSideCollision(n)===!0?ye!==!0&&(we[o.id]=!0,Qe(t,o)):ye!==!0&&void 0!==we[o.id]&&(delete we[o.id],$e(t,o)):delete we[o.id])}}else t.checkIsRemoved()!==!0?n.checkOneSideCollision(t)===!0||n.type!==t.type&&t.checkOneSideCollision(n)===!0?void 0===we[t.id]&&(we[t.id]=!0,Qe(t,t)):void 0!==we[t.id]&&(delete we[t.id],$e(t,t)):(xe.splice(e,1),e-=1,delete we[t.id],delete Ye[t.id],delete Ie[t.id]);if(void 0===xe)break}});n.step=(e=>{if(0===Xe){if(j=i,Q=o,0!==h&&(u+=h*e),void 0!==x&&u<x&&(u=x,0===u)){if(void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}if(void 0!==A&&u>A&&(u=A,0===u)){if(void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}if(0!==E&&(S+=E*e),void 0!==w&&S<w&&(S=w,0===S)){if(void 0!==ne){let e=ne;ne=void 0,e()}if(void 0!==$&&0===u){let e=$;$=void 0,e()}}if(void 0!==T&&S>T&&(S=T,0===S)){if(void 0!==ne){let e=ne;ne=void 0,e()}if(void 0!==$&&0===u){let e=$;$=void 0,e()}}if(0!==u){let n=u*e;if((n<0&&fe!==!0||n>0&&ue!==!0)&&(i+=n,void 0!==F&&(u>0&&i>F||u<0&&i<F))){if(i=F,F=void 0,x=void 0,A=void 0,u=0,h=0,void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}}if(0!==S){let n=S*e;if((n<0&&Se!==!0||n>0&&se!==!0)&&(o+=n,void 0!==W&&(S>0&&o>W||S<0&&o<W))){if(o=W,W=void 0,w=void 0,T=void 0,S=0,E=0,void 0!==ne){let e=ne;ne=void 0,e()}if(void 0!==$&&0===u){let e=$;$=void 0,e()}}}if(0!==y&&(s+=y*e),void 0!==Y&&s<Y&&(s=Y),void 0!==P&&s>P&&(s=P),0!==k&&(v+=k*e),void 0!==I&&v<I&&(v=I),void 0!==O&&v>O&&(v=O),0!==s&&(l+=s*e,void 0!==L&&(s>0&&l>L||s<0&&l<L))){if(l=L,L=void 0,Y=void 0,P=void 0,s=0,y=0,void 0!==ie){let e=ie;ie=void 0,e()}if(void 0!==te&&0===v){let e=te;te=void 0,e()}}if(0!==v&&(g+=v*e,void 0!==N&&(v>0&&g>N||v<0&&g<N))){if(g=N,N=void 0,I=void 0,O=void 0,v=0,k=0,void 0!==oe){let e=oe;oe=void 0,e()}if(void 0!==te&&0===s){let e=te;te=void 0,e()}}if(0!==m&&(p+=m*e),void 0!==X&&p<X&&(p=X),void 0!==M&&p>M&&(p=M),0!==p){if(d+=p*e,void 0!==V&&d+V<360&&(p>0&&d>=V||p<0&&d<=V)&&(d=V,V=void 0,X=void 0,M=void 0,p=0,m=0,void 0!==ae)){let e=ae;ae=void 0,e()}d>=360?d=0:d<=0&&(d=360)}if(0!==C&&(R+=C*e),void 0!==D&&R<D&&(R=D),void 0!==H&&R>H&&(R=H),0!==R){if(f+=R*e,void 0!==_&&(R>0&&f>_||R<0&&f<_)&&(f=_,_=void 0,D=void 0,H=void 0,R=0,C=0,void 0!==ce)){let e=ce;ce=void 0,e()}f>1?f=1:f<0&&(f=0)}if(Ve(),ye!==!0)for(let t=0;t<Ce.length;t+=1)Ce[t].step(e);if(ye!==!0)for(let t=0;t<me.length;t+=1)me[t].step(e);if(ye!==!0&&en(),ye!==!0)for(let t=0;t<he.length;t+=1)he[t].step(e);ye!==!0&&void 0!==ke.offscreen&&n.checkOffScreen()===!0&&je("offscreen"),ye!==!0&&void 0!==ke.nextstep&&(je("nextstep"),Je("nextstep")),ye===!0||void 0===ke.move||i===j&&o===Q||je("move")}}),n.draw=(e=>{if(void 0!==ve){let n=SkyEngine.Screen.getRatio();ve.addStyle({left:SkyEngine.Screen.getLeft()+(SkyEngine.Screen.getWidth()/2+U-SkyEngine.Screen.getCameraFollowX())*n-ve.getWidth()/2,top:SkyEngine.Screen.getTop()+(SkyEngine.Screen.getHeight()/2+G-SkyEngine.Screen.getCameraFollowY())*n-ve.getHeight()/2,transform:"rotate("+z+"rad) scale("+n*K+", "+n*q+")",opacity:e.globalAlpha,filter:e.filter})}}),n.drawArea=(e=>{}),n.pause=(()=>{Xe+=1}),n.checkIsPaused=(()=>{return Xe>0}),n.resume=(()=>{Xe-=1,Xe<0&&(Xe=0)});Ve()},afterInit:(e,n,t)=>{void 0!==t&&(void 0!==t.c&&(CHECK_IS_ARRAY(t.c)===!0?EACH(t.c,e=>{n.append(e)}):n.append(t.c)),void 0!==t.dom&&(CHECK_IS_ARRAY(t.dom)===!0?EACH(t.dom,e=>{n.addDom(e)}):n.addDom(t.dom)),void 0!==t.domStyle&&n.addDomStyle(t.domStyle),void 0!==t.on&&EACH(t.on,(e,t)=>{n.on(t,e)}),void 0!==t.touchArea&&(CHECK_IS_ARRAY(t.touchArea)===!0?EACH(t.touchArea,e=>{n.addTouchArea(e)}):n.addTouchArea(t.touchArea)),void 0!==t.collider&&(CHECK_IS_ARRAY(t.collider)===!0?EACH(t.collider,e=>{n.addCollider(e)}):n.addCollider(t.collider)))}}),SkyEngine.Screen=OBJECT({preset:()=>{return SkyEngine.Node},init:(e,n)=>{let t,i,o,a,c,r,l,g,d,f,u,S,s,v,p=DIV({style:{position:"fixed",left:0,top:0,zIndex:-1}}).appendTo(BODY),R=CANVAS().appendTo(p),h=R.getContext("2d"),E={},y=0,k=0;n.registerNode=(e=>{let n=e.type;for(;void 0!==n&&n!==CLASS;)void 0===E[n.id]&&(E[n.id]=[]),E[n.id].push(e),n=n.mom}),n.unregisterNode=(e=>{let n=e.type;for(;void 0!==n&&n!==CLASS;){if(void 0!==E[n.id]){let t=E[n.id];for(let i=0;i<t.length;i+=1)if(t[i]===e){t.splice(i,1);break}0===E[n.id].length&&delete E[n.id]}n=n.mom}}),n.getRegisteredNodes=(e=>{return void 0===E[e.id]?[]:E[e.id]});if(BROWSER_CONFIG.SkyEngine.isDebugMode===!0){let e=DIV({style:{position:"fixed",left:5,top:5,fontSize:12,zIndex:999999}}).appendTo(BODY);INTERVAL(.1,()=>{void 0!==r&&(e.empty(),e.append("FPS: "+parseInt(1/r)))})}EACH(["tap","touchstart","touchend"],e=>{R.on(e,t=>{let i,o=n=>{if(i!==!0&&(REVERSE_EACH(n.getChildren(),o),n.checkIsEventExists(e)===!0&&n.checkTouch((t.getLeft()-WIN_WIDTH()/2)/c,(t.getTop()-WIN_HEIGHT()/2)/c)===!0)){let o=SkyEngine.E(t);n.fireEvent({eventName:e,e:o}),o.checkIsBubblingStoped()===!0&&(i=!0)}};o(n)})});let m=(e,n,t)=>{n.save(),n.translate(e.getDrawingX(),e.getDrawingY()),n.rotate(e.getRealRadian()),n.scale(e.getRealScaleX(),e.getRealScaleY()),n.lineWidth=1/(e.getRealScaleX()>e.getRealScaleY()?e.getRealScaleX():e.getRealScaleY()),n.beginPath(),e.drawArea(n),n.strokeStyle=t,n.stroke(),n.closePath(),n.restore();let i=e.getChildren();for(let o=0;o<i.length;o+=1)m(i[o],n,t)},C=(e,n,t)=>{if(e.checkIsHiding()!==!0){if(t*=e.getAlpha(),n.save(),void 0!==e.getFilter()&&(n.filter=e.getFilter()),void 0!==e.getBlendMode()&&(n.globalCompositeOperation=e.getBlendMode()),n.save(),n.translate(e.getDrawingX(),e.getDrawingY()),n.rotate(e.getRealRadian()),n.scale(e.getRealScaleX(),e.getRealScaleY()),n.globalAlpha=t,e.draw(n),n.restore(),e.checkIsRemoved()!==!0){let i=e.getChildren();for(let o=0;o<i.length;o+=1)C(i[o],n,t)}if(n.restore(),e.checkIsRemoved()!==!0&&BROWSER_CONFIG.SkyEngine.isDebugMode===!0){n.beginPath(),n.strokeStyle=n.fillStyle="aqua";let t=e.getRealX(),i=e.getRealY();n.rect(t-1,i-1,2,2),n.moveTo(t-15,i),n.lineTo(t+15,i),n.moveTo(t,i-15),n.lineTo(t,i+15),n.stroke();let o=e.getTouchAreas();for(let a=0;a<o.length;a+=1)m(o[a],n,"magenta");let c=e.getColliders();for(let a=0;a<c.length;a+=1)m(c[a],n,"lime")}}},x=LOOP(e=>{r=e,r>.03&&(r=.03),n.checkIsPaused()!==!0&&(SkyEngine.Delay.step(r),SkyEngine.Interval.step(r),n.step(r)),T.step(r),h.clearRect(0,0,o*devicePixelRatio,a*devicePixelRatio),h.save(),h.scale(devicePixelRatio,devicePixelRatio),h.translate(o/2-D(),a/2-A()),C(n,h,n.getAlpha()),h.restore()});EVENT("resize",RAR(()=>{let e=WIN_WIDTH(),n=WIN_HEIGHT();o=void 0!==BROWSER_CONFIG.SkyEngine.width?BROWSER_CONFIG.SkyEngine.width:e,a=void 0!==BROWSER_CONFIG.SkyEngine.height?BROWSER_CONFIG.SkyEngine.height:n;let r=e/o,l=n/a;c=r<l?r:l,void 0===BROWSER_CONFIG.SkyEngine.width&&(o/=c),void 0===BROWSER_CONFIG.SkyEngine.height&&(a/=c),void 0!==BROWSER_CONFIG.SkyEngine.maxWidth&&o>BROWSER_CONFIG.SkyEngine.maxWidth&&(o=BROWSER_CONFIG.SkyEngine.maxWidth),void 0!==BROWSER_CONFIG.SkyEngine.maxHeight&&a>BROWSER_CONFIG.SkyEngine.maxHeight&&(a=BROWSER_CONFIG.SkyEngine.maxHeight),R.addStyle({width:o*c,height:a*c}),t=(e-o*c)/2,i=(n-a*c)/2,p.addStyle({left:t,top:i}),R.setSize({width:o*devicePixelRatio,height:a*devicePixelRatio})})),n.on("remove",()=>{x.remove()});let w=n.cameraFollowX=(e=>{d=e.target,l=e.centerX,void 0===l&&(l=0),u=e.minX,s=e.maxX}),Y=n.cameraFollowY=(e=>{f=params.target,g=params.centerY,void 0===g&&(g=0),S=params.minY,v=params.maxY}),I=(n.cameraFollow=(e=>{w(params),Y(params)}),n.cameraUnfollowX=(e=>{d=void 0,u=void 0,s=void 0})),X=n.cameraUnfollowY=(e=>{f=void 0,S=void 0,v=void 0}),D=(n.cameraUnfollow=(e=>{I(),X()}),n.getCameraFollowX=(()=>{return void 0===d?y:d.checkIsRemoved()===!0?(d=void 0,y):(y=d.getRealX()-l,void 0!==u&&y<u?u:void 0!==s&&y>s?s:y)})),A=n.getCameraFollowY=(()=>{return void 0===f?k:f.checkIsRemoved()===!0?(f=void 0,k):(k=f.getRealY()-g,void 0!==S&&k<S?S:void 0!==v&&k>v?v:k)}),T=(n.getLeft=(()=>{return t}),n.getTop=(()=>{return i}),n.getWidth=(()=>{return o}),n.getHeight=(()=>{return a}),n.getRatio=(()=>{return c}),n.getCanvas=(()=>{return R}),n.getCanvasContext=(()=>{return h}),SkyEngine.Node());n.getNonePausableNode=(()=>{return T})}}),SkyEngine.TextBorderShadow=METHOD({run:e=>{return"1px 1px 0 "+e+",-1px 1px 0 "+e+",1px -1px 0 "+e+",-1px -1px 0 "+e+",0px 1px 0 "+e+",0px -1px 0 "+e+",-1px 0px 0 "+e+",1px 0px 0 "+e+",2px 2px 0 "+e+",-2px 2px 0 "+e+",2px -2px 0 "+e+",-2px -2px 0 "+e+",0px 2px 0 "+e+",0px -2px 0 "+e+",-2px 0px 0 "+e+",2px 0px 0 "+e+",1px 2px 0 "+e+",-1px 2px 0 "+e+",1px -2px 0 "+e+",-1px -2px 0 "+e+",2px 1px 0 "+e+",-2px 1px 0 "+e+",2px -1px 0 "+e+",-2px -1px 0 "+e}}),SkyEngine.Figure=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,a,c=t.color,r=t.border;if(void 0!==r){let e=r.split(" ");i=INTEGER(e[0]),o=e[1],a=e[2]}let l;OVERRIDE(n.draw,e=>{l=n.draw=(n=>{void 0!==c&&(n.fillStyle=c,n.fill()),void 0!==r&&(n.lineWidth=i,n.strokeStyle=a,"dashed"===o?n.setLineDash([5]):"dotted"===o&&n.setLineDash([2]),n.stroke()),n.closePath(),e(n)})});let g;OVERRIDE(n.drawArea,e=>{g=n.drawArea=(n=>{e(n)})})}}),SkyEngine.FixedNode=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i;void 0!==t&&(i=t.followScreenRatio),void 0===i&&(i=0);let o,a=0,c=0;OVERRIDE(n.step,e=>{o=n.step=(t=>{if(1!==i){let e=SkyEngine.Screen.getCameraFollowX()-SkyEngine.Screen.getX(),t=SkyEngine.Screen.getCameraFollowY()-SkyEngine.Screen.getY();n.setX(n.getX()+(e-a)*(1-i)/n.getRealScaleX()),n.setY(n.getY()+(t-c)*(1-i)/n.getRealScaleY()),a=e,c=t}e(t)})})}}),SkyEngine.StateSet=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,a={},c=n.setStateNode=(e=>{let t=e.state,i=e.node;void 0!==a[name]&&a[name].remove(),i.hide(),n.append(i),a[t]=i});EACH(t.stateNodes,(e,n)=>{c({state:n,node:e})});let r=n.setState=((e,n)=>{void 0!==o&&(a[i].off("animationend",o),o=void 0),i=e,o=n,EACH(a,e=>{e.hide()});let t=a[i];void 0!==t&&t.show(),void 0!==o&&t.on("animationend",o)});r(t.baseState);n.getState=(()=>{return i})}}),SkyEngine.Circle=CLASS(e=>{e.findRaycastPoints=((e,n,t,i,o,a,c,r,l,g)=>{let d=g*e+l*n-t,f=-l*e+g*n-i;o*=c,a*=r;let u=o/2,S=a/2,s=99999,v=(1-d*s/u/u*S*S)/f+i;s+=t;let p=-99999,R=(1-d*p/u/u*S*S)/f+i;return p+=t,SkyEngine.Line.findCircleIntersectionPoints(0,0,s,v,p,R,1,1,0,1,t,i,o,a,1,1,l,g)});return{preset:()=>{return SkyEngine.Figure},init:(n,t,i)=>{let o=i.width,a=i.height,c=SkyEngine.Util.Collision.checkPointInCircle,r=SkyEngine.Util.Collision.checkLineCircle,l=SkyEngine.Util.Collision.checkRectCircle,g=SkyEngine.Util.Collision.checkCircleCircle;t.setWidth=(e=>{o=e}),t.getWidth=(()=>{return o}),t.setHeight=(e=>{a=e}),t.getHeight=(()=>{return a});OVERRIDE(t.checkPoint,e=>{t.checkPoint=((n,i)=>{return c(n,i,t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n,i)===!0})});let d;OVERRIDE(t.checkArea,e=>{d=t.checkArea=(n=>{if(n.type===SkyEngine.Line){if(r(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect){if(l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Circle&&g(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0;return e(n)})});let f;OVERRIDE(t.checkOffScreen,e=>{f=t.checkOffScreen=(()=>{return l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e()})});let u;OVERRIDE(t.draw,e=>{u=t.draw=(n=>{n.beginPath(),n.ellipse(0,0,o/2,a/2,0,0,2*Math.PI),e(n)})});let S;OVERRIDE(t.drawArea,e=>{S=t.drawArea=(n=>{n.ellipse(0,0,o/2,a/2,0,0,2*Math.PI),e(n)})});t.findRaycastPoints=((n,i)=>{return e.findRaycastPoints(n,i,t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())})}}}),SkyEngine.Line=CLASS(e=>{let n=e.findLineIntersectionPoint=((e,n,t,i,o,a,c,r,l,g,d,f,u,S,s,v,p,R,h,E)=>{if(SkyEngine.Util.Collision.checkLineLine(e,n,t,i,o,a,c,r,l,g,d,f,u,S,s,v,p,R,h,E)===!0){t*=c,i*=r;let y=e+g*t+l*i,k=n+l*t+g*i;o*=c,a*=r;let m=e+g*o+l*a,C=n+l*o+g*a;u*=p,S*=R;let x=d+E*u+h*S,w=f+h*u+E*S;s*=p,v*=R;let Y=d+E*s+h*v,I=f+h*s+E*v,X=(m-y)*(I-w)-(Y-x)*(C-k);return{x:((m*k-C*y)*(Y-x)-(m-y)*(Y*w-I*x))/X,y:((m*k-C*y)*(I-w)-(C-k)*(Y*w-I*x))/X}}}),t=e.findRectIntersectionPoints=((e,t,i,o,a,c,r,l,g,d,f,u,S,s,v,p,R,h)=>{let E=[];i*=r,o*=l;let y=e+d*i+g*o,k=t+g*i+d*o;a*=r,c*=l;let m,C,x,w,Y,I,X,D,A=e+d*a+g*c,T=t+g*a+d*c;S*=v/2,s*=p/2;let P=h*S,O=h*s,M=-R*S,H=-R*s;m=f-P-H,C=u+M-O,x=f+P-H,w=u-M-O,Y=f+P+H,I=u-M+O,X=f-P+H,D=u+M+O;let F=n(0,0,y,k,A,T,1,1,0,1,0,0,m,C,x,w,1,1,0,1);return void 0!==F&&E.push(F),F=n(0,0,y,k,A,T,1,1,0,1,0,0,x,w,Y,I,1,1,0,1),void 0!==F&&E.push(F),F=n(0,0,y,k,A,T,1,1,0,1,0,0,Y,I,X,D,1,1,0,1),void 0!==F&&E.push(F),F=n(0,0,y,k,A,T,1,1,0,1,0,0,X,D,m,C,1,1,0,1),void 0!==F&&E.push(F),E}),i=e.findCircleIntersectionPoints=((e,n,t,i,o,a,c,r,l,g,d,f,u,S,s,v,p,R)=>{let h=[];if(SkyEngine.Util.Collision.checkLineCircle(e,n,t,i,o,a,c,r,l,g,d,f,u,S,s,v,p,R)===!0){t*=c,i*=r;let E=e+g*t+l*i-d,y=n+l*t+g*i-f;o*=c,a*=r;let k=e+g*o+l*a-d,m=n+l*o+g*a-f,C=R*E+p*y,x=-p*E+R*y,w=R*k+p*m,Y=-p*k+R*m;u*=s,S*=v;let I=u/2,X=S/2,D=(Y-x)/(w-C),A=x-D*C,T=D*D*I*I+X*X,P=2*D*A*I*I,O=I*I*A*A-I*I*X*X,M=P*P-4*T*O;if(M>0){let e=(-P+Math.sqrt(M))/(2*T),n=D*e+A,t=(-P-Math.sqrt(M))/(2*T),i=D*t+A;(C<w?C:w)<=e&&e<=(C<w?w:C)&&(x<Y?x:Y)<=n&&n<=(x<Y?Y:x)&&h.push({x:R*e-p*n+d,y:p*e+R*n+f}),(C<w?C:w)<=t&&t<=(C<w?w:C)&&(x<Y?x:Y)<=i&&i<=(x<Y?Y:x)&&h.push({x:R*t-p*i+d,y:p*t+R*i+f})}else if(0===M){let e=-P/(2*T),n=D*e+A;(C<w?C:w)<=e&&e<=(C<w?w:C)&&(x<Y?x:Y)<=n&&n<=(x<Y?Y:x)&&h.push({x:R*e-p*n+d,y:p*e+R*n+f})}}return h}),o=e.findPolygonIntersectionPoints=((e,t,i,o,a,c,r,l,g,d,f,u,S,s,v,p,R)=>{let h=[];i*=r,o*=l;let E=e+d*i+g*o,y=t+g*i+d*o;a*=r,c*=l;let k=e+d*a+g*c,m=t+g*a+d*c,C=S.length;for(let x=0,w=C-1;x<C;w=x,x+=1){let e=S[x].x*s,t=S[x].y*v,i=S[w].x*s,o=S[w].y*v,a=f+R*e-p*t,c=u+p*e+R*t,r=f+R*i-p*o,l=u+p*i+R*o,g=n(0,0,E,y,k,m,1,1,0,1,0,0,a,c,r,l,1,1,0,1);void 0!==g&&h.push(g)}return h});return{preset:()=>{return SkyEngine.Figure},init:(e,a,c)=>{let r=c.startX,l=c.startY,g=c.endX,d=c.endY,f=c.isEndless,u=SkyEngine.Util.Collision.checkLineLine,S=SkyEngine.Util.Collision.checkLineRect;f===!0&&(Math.abs(g-r)<Math.abs(d-l)?(g=((d-l<0?-999999:999999)-l)/(d-l)*(g-r)+r,d=d-l<0?-999999:999999):(d=(d-l)/(g-r)*((g-r<0?-999999:999999)-r)+l,g=g-r<0?-999999:999999));let s;a.setStartX=(e=>{r=e}),a.getStartX=(()=>{return r}),a.setStartY=(e=>{l=e}),a.getStartY=(()=>{return l}),a.setEndX=(e=>{g=e}),a.getEndX=(()=>{return g}),a.setEndY=(e=>{d=e}),a.getEndY=(()=>{return d});OVERRIDE(a.checkArea,e=>{s=a.checkArea=(n=>{return n.type===SkyEngine.Line&&u(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),a.getDrawingX(),a.getDrawingY(),r,l,g,d,a.getRealScaleX(),a.getRealScaleY(),a.getRealSin(),a.getRealCos())===!0||e(n)})});let v;OVERRIDE(a.checkOffScreen,e=>{v=a.checkOffScreen=(()=>{return S(a.getDrawingX(),a.getDrawingY(),r,l,g,d,a.getRealScaleX(),a.getRealScaleY(),a.getRealSin(),a.getRealCos(),SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1)!==!0&&e()})});let p;OVERRIDE(a.draw,e=>{p=a.draw=(n=>{n.beginPath(),n.moveTo(r,l),n.lineTo(g,d),e(n)})});let R;OVERRIDE(a.drawArea,e=>{R=a.drawArea=(n=>{n.moveTo(r,l),n.lineTo(g,d),e(n)})});a.findIntersectionPoints=(e=>{let c=[];if(e.checkIsInstanceOf(SkyEngine.Line)===!0){let t=n(a.getDrawingX(),a.getDrawingY(),r,l,g,d,a.getRealScaleX(),a.getRealScaleY(),a.getRealSin(),a.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getStartX(),e.getStartY(),e.getEndX(),e.getEndY(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos());void 0!==t&&c.push(t)}else e.checkIsInstanceOf(SkyEngine.Rect)===!0?c=t(a.getDrawingX(),a.getDrawingY(),r,l,g,d,a.getRealScaleX(),a.getRealScaleY(),a.getRealSin(),a.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Circle)===!0?c=i(a.getDrawingX(),a.getDrawingY(),r,l,g,d,a.getRealScaleX(),a.getRealScaleY(),a.getRealSin(),a.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Polygon)===!0&&(c=o(a.getDrawingX(),a.getDrawingY(),r,l,g,d,a.getRealScaleX(),a.getRealScaleY(),a.getRealSin(),a.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getPoints(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()));
return c})}}}),SkyEngine.Polygon=CLASS(e=>{e.findRaycastPoints=((e,n,t,i,o,a,c,r,l)=>{let g,d,f,u,S,s,v=o.length;for(let p=0;p<v;p+=1){let v=o[p].x*a,R=o[p].y*c,h=t+l*v-r*R,E=i+r*v+l*R,y=h-e,k=E-n,m=Math.acos(y/Math.sqrt(y*y+k*k));k>0&&(m=Math.PI+Math.PI-m),(void 0==g||g>m)&&(g=m,d=h,f=E),(void 0==u||u<m)&&(u=m,S=h,s=E)}return void 0===g?[]:[{x:d,y:f},{x:S,y:s}]});return{preset:()=>{return SkyEngine.Figure},init:(n,t,i)=>{let o=i.points,a=SkyEngine.Util.Collision.checkPointInPolygon,c=SkyEngine.Util.Collision.checkLinePolygon,r=SkyEngine.Util.Collision.checkRectPolygon,l=SkyEngine.Util.Collision.checkCirclePolygon,g=SkyEngine.Util.Collision.checkPolygonPolygon;t.getPoints=(()=>{return o}),t.setColor=(e=>{e=_color}),t.getColor=(()=>{return color});OVERRIDE(t.checkPoint,e=>{t.checkPoint=((n,i)=>{return a(n,i,t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n,i)===!0})});let d;OVERRIDE(t.checkArea,e=>{d=t.checkArea=(n=>{if(n.type===SkyEngine.Line){if(c(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect){if(r(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Circle){if(l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Polygon&&g(n.getDrawingX(),n.getDrawingY(),n.getPoints(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0;return e(n)})});let f;OVERRIDE(t.checkOffScreen,e=>{f=t.checkOffScreen=(()=>{return r(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e()})});let u;OVERRIDE(t.draw,e=>{u=t.draw=(n=>{if(n.beginPath(),o.length>0){n.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let t=o[e];n.lineTo(t.x,t.y)}n.lineTo(o[0].x,o[0].y)}e(n)})});let S;OVERRIDE(t.drawArea,e=>{S=t.drawArea=(n=>{if(o.length>0){n.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let t=o[e];n.lineTo(t.x,t.y)}n.lineTo(o[0].x,o[0].y)}e(n)})});t.findRaycastPoints=((n,i)=>{return e.findRaycastPoints(n,i,t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())})}}}),SkyEngine.Rect=CLASS(e=>{e.findRaycastPoints=((e,n,t,i,o,a,c,r,l,g)=>{let d,f,u,S,s,v,p,R;o*=c,a*=r;let h=g*o/2,E=g*a/2,y=-l*o/2,k=-l*a/2;d=t-h-k,f=i+y-E,u=t+h-k,S=i-y-E,s=t+h+k,v=i-y+E,p=t-h+k,R=i+y+E;let m=d-e,C=f-n,x=Math.acos(m/Math.sqrt(m*m+C*C));C>0&&(x=Math.PI+Math.PI-x);let w=x,Y=d,I=f,X=x,D=d,A=f;return m=u-e,C=S-n,x=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(x=Math.PI+Math.PI-x),w>x&&(w=x,Y=u,I=S),X<x&&(X=x,D=u,A=S),m=s-e,C=v-n,x=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(x=Math.PI+Math.PI-x),w>x&&(w=x,Y=s,I=v),X<x&&(X=x,D=s,A=v),m=p-e,C=R-n,x=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(x=Math.PI+Math.PI-x),w>x&&(w=x,Y=p,I=R),X<x&&(X=x,D=p,A=R),[{x:Y,y:I},{x:D,y:A}]});return{preset:()=>{return SkyEngine.Figure},init:(n,t,i)=>{let o=i.width,a=i.height,c=SkyEngine.Util.Collision.checkPointInRect,r=SkyEngine.Util.Collision.checkLineRect,l=SkyEngine.Util.Collision.checkRectRect;t.setWidth=(e=>{o=e}),t.getWidth=(()=>{return o}),t.setHeight=(e=>{a=e}),t.getHeight=(()=>{return a}),t.setColor=(e=>{e=_color}),t.getColor=(()=>{return color});OVERRIDE(t.checkPoint,e=>{t.checkPoint=((n,i)=>{return c(n,i,t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n,i)===!0})});let g;OVERRIDE(t.checkArea,e=>{g=t.checkArea=(n=>{if(n.type===SkyEngine.Line){if(r(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect&&l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0;return e(n)})});let d;OVERRIDE(t.checkOffScreen,e=>{d=t.checkOffScreen=(()=>{return l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e()})});let f;OVERRIDE(t.draw,e=>{f=t.draw=(n=>{n.beginPath(),n.rect(-o/2,-a/2,o,a),e(n)})});let u;OVERRIDE(t.drawArea,e=>{u=t.drawArea=(n=>{n.rect(-o/2,-a/2,o,a),e(n)})});t.findRaycastPoints=((n,i)=>{return e.findRaycastPoints(n,i,t.getDrawingX(),t.getDrawingY(),o,a,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())})}}}),SkyEngine.Background=CLASS({preset:()=>{return SkyEngine.FixedNode},init:(e,n,t)=>{let i=t.src,o=t.isNotToRepeatX,a=t.isNotToRepeatY,c=t.leftMargin,r=t.rightMargin,l=t.topMargin,g=t.bottomMargin;void 0===c&&(c=0),void 0===r&&(r=0),void 0===l&&(l=0),void 0===g&&(g=0);let d,f,u=new Image;u.onload=(()=>{d=u.width,f=u.height,u.onload=void 0,n.fireEvent("load")}),u.src=i;let S;OVERRIDE(n.draw,e=>{S=n.draw=(t=>{if(void 0!==d)if(o===!0&&a===!0)t.drawImage(u,-d/2,-f/2,d,f);else if(o===!0){let e=-f/2,i=(SkyEngine.Screen.getCameraFollowY()-SkyEngine.Screen.getY())/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY(),o=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY();for(;i-o<e+n.getY();)e-=l+f+g;for(;e+n.getY()<i+o;)t.drawImage(u,-d/2,e,d,f),e+=l+f+g}else if(a===!0){let e=-d/2,i=(SkyEngine.Screen.getCameraFollowX()-SkyEngine.Screen.getX())/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),o=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX();for(;i-o<e+n.getX();)e-=c+d+r;for(;e+n.getX()<i+o;)t.drawImage(u,e,-f/2,d,f),e+=c+d+r}else{let e=-d/2,i=-f/2,o=(SkyEngine.Screen.getCameraFollowX()-SkyEngine.Screen.getX())/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),a=(SkyEngine.Screen.getCameraFollowY()-SkyEngine.Screen.getY())/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY(),S=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),s=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY();for(;o-S<e+n.getX();)e-=c+d+r;for(;a-s<i+n.getY();)i-=l+f+g;for(;i+n.getY()<a+s;){let a=e;for(;a+n.getX()<o+S;)t.drawImage(u,a,i,d,f),a+=c+d+r;i+=l+f+g}}e(t)})});let s;OVERRIDE(n.remove,e=>{s=n.remove=(()=>{u.onload=void 0,u=void 0,e()})});e.getImg=(()=>{return u})}}),SkyEngine.Image=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,a,c,r=t.src,l=SkyEngine.Util.Collision.checkRectRect,g=!1,d=new Image;d.onload=(()=>{a=d.width,c=d.height,d.onload=void 0,n.fireEvent("load")}),d.src=r;let f;OVERRIDE(n.checkPoint,e=>{f=n.checkPoint=((t,o)=>{if(void 0===i){if(g!==!0){let e=new Image;e.onload=(()=>{let n=e.width,t=e.height,o=CANVAS({style:{display:"none"},width:n,height:t}).appendTo(BODY),a=o.getContext("2d");a.drawImage(e,0,0,n,t),i=a.getImageData(0,0,n,t).data,a=void 0,o.remove(),e.onload=void 0}),e.src=r,g=!0}return e(t,o)===!0}let l=t-n.getDrawingX(),d=o-n.getDrawingY(),f=Math.cos(-n.getRealRadian()),u=Math.sin(-n.getRealRadian()),S=f*l-u*d,s=f*d+u*l;return S=parseInt((S+a*n.getRealScaleX()/2)/n.getRealScaleX()),s=parseInt((s+c*n.getRealScaleY()/2)/n.getRealScaleY()),S>=0&&S<a&&s>=0&&s<c&&i[4*(s*a+S)+3]>20||e(t,o)===!0})});let u;OVERRIDE(n.checkOffScreen,e=>{u=n.checkOffScreen=(()=>{return void 0!==a&&l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),a,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let S;OVERRIDE(n.draw,e=>{S=n.draw=(n=>{n.drawImage(d,-a/2,-c/2,a,c),e(n)})});let s;OVERRIDE(n.drawArea,e=>{s=n.drawArea=(n=>{if(void 0===o)if(void 0===i){if(g!==!0){let e=new Image;e.onload=(()=>{let n=e.width,t=e.height,a=CANVAS({style:{display:"none"},width:n,height:t}).appendTo(BODY),c=a.getContext("2d");c.drawImage(e,0,0,n,t),i=c.getImageData(0,0,n,t).data,o=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(i,n),c=void 0,a.remove(),e.onload=void 0}),e.src=r,g=!0}}else o=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(i,a);else if(o.length>0){n.moveTo(o[0].x-a/2,o[0].y-c/2);for(let e=1;e<o.length;e+=1){let t=o[e];n.lineTo(t.x-a/2,t.y-c/2)}n.lineTo(o[0].x-a/2,o[0].y-c/2)}e(n)})});let v;OVERRIDE(n.remove,e=>{v=n.remove=(()=>{d.onload=void 0,d=void 0,i=void 0,o=void 0,e()})});e.getImg=(()=>{return d})}}}),SkyEngine.Silhouette=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,a,c=t.src,r=t.color,l=t.border,g=SkyEngine.Util.Collision.checkRectRect;if(void 0!==l){let e=l.split(" ");i=INTEGER(e[0]),o=e[1],a=e[2]}let d,f,u,S,s,v=n.setSrc=(e=>{c=e,d=new Image,d.onload=(()=>{S=d.width,s=d.height;let e=CANVAS({style:{display:"none"},width:S,height:s}).appendTo(BODY),t=e.getContext("2d");t.drawImage(d,0,0,S,s);let i=t.getImageData(0,0,S,s);f=i.data;let o,a=f.length;for(o=0;o<a;o+=4)f[o]=0,f[o+1]=0,f[o+2]=0;d.onload=void 0,t.clearRect(0,0,S,s),t.putImageData(i,0,0),t.globalCompositeOperation="source-in",t.rect(0,0,S,s),t.fillStyle=r,t.fill(),d.src=e.getEl().toDataURL(),i=void 0,t=void 0,e.remove(),void 0!==l&&(u=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(f,S)),n.fireEvent("load")}),d.src=c});v(c);let p;OVERRIDE(n.checkPoint,e=>{p=n.checkPoint=((t,i)=>{if(void 0===f)return e(t,i)===!0;let o=t-n.getDrawingX(),a=i-n.getDrawingY(),c=Math.cos(-n.getRealRadian()),r=Math.sin(-n.getRealRadian()),l=c*o-r*a,g=c*a+r*o;return l=parseInt((l+S*n.getRealScaleX()/2)/n.getRealScaleX()),g=parseInt((g+s*n.getRealScaleY()/2)/n.getRealScaleY()),l>=0&&l<S&&g>=0&&g<s&&f[4*(g*S+l)+3]>20||e(t,i)===!0})});let R;OVERRIDE(n.checkOffScreen,e=>{R=n.checkOffScreen=(()=>{return void 0!==S&&g(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),S,s,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let h;OVERRIDE(n.draw,e=>{h=n.draw=(n=>{if(void 0!==f&&(void 0!==r&&n.drawImage(d,-S/2,-s/2,S,s),void 0!==l&&u.length>0)){n.beginPath(),n.moveTo(u[0].x-S/2,u[0].y-s/2);for(let e=1;e<u.length;e+=1){let t=u[e];n.lineTo(t.x-S/2,t.y-s/2)}n.lineTo(u[0].x-S/2,u[0].y-s/2),n.lineWidth=i,n.strokeStyle=a,"dashed"===o?n.setLineDash([5]):"dotted"===o&&n.setLineDash([2]),n.stroke(),n.closePath()}e(n)})});let E;OVERRIDE(n.drawArea,e=>{E=n.drawArea=(n=>{if(void 0===u)void 0!==f&&(u=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(f,S));else if(u.length>0){n.moveTo(u[0].x-S/2,u[0].y-s/2);for(let e=1;e<u.length;e+=1){let t=u[e];n.lineTo(t.x-S/2,t.y-s/2)}n.lineTo(u[0].x-S/2,u[0].y-s/2)}e(n)})});let y;OVERRIDE(n.remove,e=>{y=n.remove=(()=>{d.onload=void 0,d=void 0,f=void 0,u=void 0,e()})});e.getImg=(()=>{return d}),e.getPolygonPoints=(()=>{return u})}}}),SkyEngine.Sprite=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,a,c,r,l=t.src,g=t.srcs,d=t.spriteWidth,f=t.spriteHeight,u=t.fps,S=SkyEngine.Util.Collision.checkRectRect,s=0,v=0,p=0,R=!1;void 0===u&&(u=0),void 0!==l&&(i=new Image,i.onload=(()=>{a=i.width,c=i.height,void 0===d&&(d=a),void 0===f&&(f=c),void 0===r&&(r=a/d*c/f),i.onload=void 0,n.fireEvent("load")}),i.src=l),void 0!==g&&EACH(g,e=>{let t=new Image;void 0===o&&(o=[]),t.onload=(()=>{a=t.width,c=t.height,void 0===d&&(d=a),void 0===f&&(f=c),void 0===r?r=1:r+=1,t.onload=void 0,n.fireEvent("load")}),t.src=e,o.push(t)});let h,E=(n.getFrame=(()=>{return v}),n.getBeforeFrame=(()=>{return p}),n.stop=(()=>{R=!0})),y=n.resume=(()=>{R=!1});OVERRIDE(n.hide,e=>{h=n.hide=(()=>{s=0,v=0,p=0,E(),e()})});let k;OVERRIDE(n.show,e=>{k=n.show=(()=>{s=0,v=0,p=0,y(),e()})});let m;OVERRIDE(n.checkOffScreen,e=>{m=n.checkOffScreen=(()=>{return void 0!==a&&S(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),d,f,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let C;OVERRIDE(n.step,e=>{C=n.step=(t=>{R!==!0&&(u>0&&(s+=u*t),void 0!==r&&s>=r&&(s-=r,n.fireEvent("animationend")),p=v,v=Math.floor(s),v!==p&&n.fireEvent("framechange")),e(t)})});let x;OVERRIDE(n.draw,e=>{x=n.draw=(n=>{if(void 0!==o){if(void 0!==r){let e=o[v];void 0!==e&&n.drawImage(e,-a/2,-c/2,a,c)}}else void 0!==a&&void 0!==c&&void 0!==d&&void 0!==f&&n.drawImage(i,d*Math.floor(s%(a/d)),f*Math.floor(s/(a/d)),d,f,-d/2,-f/2,d,f);e(n)})});let w;OVERRIDE(n.remove,e=>{w=n.remove=(()=>{g=void 0,void 0!==i&&(i.onload=void 0,i=void 0),EACH(o,e=>{e.onload=void 0}),o=void 0,e()})});e.getImg=(()=>{return i}),e.getImgs=(()=>{return o}),e.getRealFrame=(()=>{return s})}}),SkyEngine.ParticleSystem=CLASS(()=>{let e=(e,n)=>{return Math.random()*(n-e)+e};return{preset:()=>{return SkyEngine.Node},init:(n,t,i)=>{let o,a,c=i.particleSrc,r=i.particleFigure,l=i.particleStartX,g=i.particleStartY,d=i.particleEndX,f=i.particleEndY,u=i.particleWidth,S=i.particleHeight,s=i.particlePoints,v=i.particleColor,p=i.particleBorder,R=i.particleColorR,h=i.minParticleColorR,E=i.maxParticleColorR,y=i.particleColorG,k=i.minParticleColorG,m=i.maxParticleColorG,C=i.particleColorB,x=i.minParticleColorB,w=i.maxParticleColorB,Y=i.particleCenterX,I=i.particleCenterY,X=i.particleCount,D=i.minParticleCount,A=i.maxParticleCount,T=i.particleX,P=i.minParticleX,O=i.maxParticleX,M=i.particleY,H=i.minParticleY,F=i.maxParticleY,W=i.particleLifetime,L=i.minParticleLifetime,N=i.maxParticleLifetime,V=i.particleDirection,_=i.minParticleDirection,b=i.maxParticleDirection,B=i.particleSpeed,U=i.minParticleSpeed,G=i.maxParticleSpeed,K=i.particleAccelX,q=i.particleAccelY,z=i.particleScale,Z=i.minParticleScale,J=i.maxParticleScale,j=i.particleScalingSpeed,Q=i.minParticleScalingSpeed,$=i.maxParticleScalingSpeed,ee=i.isParticleAngleToDirection,ne=i.particleAngle,te=i.minParticleAngle,ie=i.maxParticleAngle,oe=i.particleRotationSpeed,ae=i.minParticleRotationSpeed,ce=i.maxParticleRotationSpeed,re=i.particleAlpha,le=i.minParticleAlpha,ge=i.maxParticleAlpha,de=i.particleFadingSpeed,fe=i.minParticleFadingSpeed,ue=i.maxParticleFadingSpeed;void 0===R&&(R=0),void 0===h&&(h=R),void 0===E&&(E=R),void 0===y&&(y=0),void 0===k&&(k=y),void 0===m&&(m=y),void 0===C&&(C=0),void 0===x&&(x=C),void 0===w&&(w=C),void 0===Y&&(Y=0),void 0===I&&(I=0),void 0===X&&(X=1),void 0===D&&(D=X),void 0===A&&(A=X),void 0===T&&(T=0),void 0===P&&(P=T),void 0===O&&(O=T),void 0===M&&(M=0),void 0===H&&(H=M),void 0===F&&(F=M),void 0===L&&(L=W),void 0===N&&(N=W),void 0===_&&(_=V),void 0===b&&(b=V),void 0===U&&(U=B),void 0===G&&(G=B),void 0===K&&(K=0),void 0===q&&(q=0),void 0===z&&(z=1),void 0===Z&&(Z=z),void 0===J&&(J=z),void 0===j&&(j=0),void 0===Q&&(Q=j),void 0===$&&($=j),void 0===ne&&(ne=0),void 0===te&&(te=ne),void 0===ie&&(ie=ne),void 0===oe&&(oe=0),void 0===ae&&(ae=oe),o=ae*Math.PI/180,void 0===ce&&(ce=oe),a=ae*Math.PI/180,void 0===re&&(re=1),void 0===le&&(le=re),void 0===ge&&(ge=re),void 0===de&&(de=0),void 0===fe&&(fe=de),void 0===ue&&(ue=de);let Se,se,ve;if(void 0!==p){let e=p.split(" ");Se=INTEGER(e[0]),se=e[1],ve=e[2]}let pe,Re,he;void 0!==c?(he=new Image,he.onload=(()=>{pe=he.width,void 0===u&&(u=pe),Re=he.height,void 0===S&&(S=Re),he.onload=void 0,t.fireEvent("load")}),he.src=c):t.fireEvent("load");let Ee,ye,ke=[];t.burst=(n=>{Ee=n,REPEAT(e(D,A),()=>{let n=e(_,b)*Math.PI/180,t=Math.sin(n),i=Math.cos(n),c=e(U,G),l={time:0,lifetime:e(L,N),x:e(P,O),y:e(H,F),scalingSpeed:e(Q,$),direction:n,speedX:c*i,speedY:c*t,scale:e(Z,J),rotationSpeedRadian:e(o,a),radian:e(te,ie)*Math.PI/180,fadingSpeed:e(fe,ue),alpha:e(le,ge)};void 0!==r&&void 0===v&&(l.color="rgb("+RANDOM({min:h,max:E})+", "+RANDOM({min:k,max:m})+", "+RANDOM({min:x,max:w})+")"),ke.push(l)})});OVERRIDE(t.step,e=>{ye=t.step=(n=>{for(let i=0;i<ke.length;i+=1){let e=ke[i];if(e.time+=n,e.time>e.lifetime?(ke.splice(i,1),void 0!==Ee&&0===ke.length&&Ee(t)):(e.speedX+=K*n,e.speedY+=q*n,e.x+=e.speedX*n,e.y+=e.speedY*n,e.scale+=e.scalingSpeed*n,e.scale<0&&(e.scale=0),e.radian+=e.rotationSpeedRadian*n,e.alpha+=e.fadingSpeed*n,e.alpha<0&&(e.alpha=0)),void 0===ke)break}e(n)})});let me;OVERRIDE(t.draw,e=>{me=t.draw=(n=>{for(let t=0;t<ke.length;t+=1){let e=ke[t],i=e.scale;if(n.save(),n.translate(e.x,e.y),ee===!0?n.rotate(e.direction):n.rotate(e.radian),n.scale(i,i),n.globalAlpha*=e.alpha,void 0===r)n.drawImage(he,Y-pe/2,I-Re/2,pe,Re);else{if(n.beginPath(),"line"===r)n.moveTo(Y+l,I+g),n.lineTo(Y+d,I+f);else if("rect"===r)n.rect(Y-u/2,Y-S/2,u,S);else if("circle"===r)n.ellipse(Y,I,u/2,S/2,0,0,2*Math.PI);else if("polygon"===r&&s.length>0){n.moveTo(Y+s[0].x,I+s[0].y);for(let e=1;e<s.length;e+=1){let t=s[e];n.lineTo(Y+t.x,I+t.y)}n.lineTo(Y+s[0].x,I+s[0].y)}void 0!==v?(n.fillStyle=v,n.fill()):void 0!==e.color&&(n.fillStyle=e.color,n.fill()),void 0!==p&&(n.lineWidth=Se,n.strokeStyle=ve,"dashed"===se?n.setLineDash([5]):"dotted"===se&&n.setLineDash([2]),n.stroke()),n.closePath()}n.restore()}e(n)})});let Ce;OVERRIDE(t.remove,e=>{Ce=t.remove=(()=>{void 0!==he&&(he.onload=void 0,he=void 0),ke=void 0,e()})})}}}),SkyEngine.ParticleSystemOnce=CLASS({preset:()=>{return SkyEngine.ParticleSystem},init:(e,n,t)=>{n.burst(e=>{e.remove()})}}),SkyEngine.CollisionTile=CLASS({preset:()=>{return SkyEngine.Tile}}),SkyEngine.HexagonTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,n,t)=>{let i,o=t.overlapHeight;OVERRIDE(n.addTile,t=>{i=n.addTile=(t=>{let i=t.row,a=t.col,c=t.tile,r=t.isCollider,l=n.getCollisionMap(),g=a*n.getTileWidth()+i%2*n.getTileWidth()/2,d=i*(n.getTileHeight()-o);r===!0&&(void 0===l[i]&&(l[i]=[]),l[i][a]=1);let f;f=void 0!==l[i]&&1===l[i][a]?SkyEngine.CollisionTile({x:g,y:d,c:c,collider:SkyEngine.Polygon({points:[{x:0,y:-n.getTileHeight()/2},{x:n.getTileWidth()/2,y:-n.getTileHeight()/4},{x:n.getTileWidth()/2,y:n.getTileHeight()/4},{x:0,y:n.getTileHeight()/2},{x:-n.getTileWidth()/2,y:n.getTileHeight()/4},{x:-n.getTileWidth()/2,y:-n.getTileHeight()/4}]})}):SkyEngine.Tile({x:g,y:d,c:c}),n.append(f),e.addTileNodeToMap({row:i,col:a,tileNode:f})})})}}),SkyEngine.IsometricTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,n,t)=>{let i;OVERRIDE(n.addTile,t=>{i=n.addTile=(t=>{let i=t.row,o=t.col,a=t.tile,c=t.isCollider,r=n.getCollisionMap(),l=o*n.getTileWidth()+i%2*n.getTileWidth()/2,g=i*n.getTileHeight()/2;c===!0&&(void 0===r[i]&&(r[i]=[]),r[i][o]=1);let d;d=void 0!==r[i]&&1===r[i][o]?SkyEngine.CollisionTile({x:l,y:g,c:a,collider:SkyEngine.Polygon({points:[{x:0,y:-n.getTileHeight()/2},{x:n.getTileWidth()/2,y:0},{x:0,y:n.getTileHeight()/2},{x:-n.getTileWidth()/2,y:0}]})}):SkyEngine.Tile({x:l,y:g,c:a}),n.append(d),e.addTileNodeToMap({row:i,col:o,tileNode:d})})})}}),SkyEngine.Tile=CLASS({preset:()=>{return SkyEngine.Node}}),SkyEngine.TileMap=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i=t.tileWidth,o=t.tileHeight,a=t.tileSet,c=t.tileKeyMap;void 0===a&&(a={}),void 0===c&&(c=[]);let r,l=[];n.getTileWidth=(()=>{return i}),n.getTileHeight=(()=>{return o}),n.addTile=(e=>{let t=e.row,r=e.col,g=e.tile,d=e.key;void 0!==d&&void 0!==a[d]&&(g=a[d](t,r),void 0===c[t]&&(c[t]=[]),c[t][r]=d),void 0!==g&&(g.setPosition({x:r*i,y:t*o}),n.append(g),void 0===l[t]&&(l[t]=[]),l[t][r]=g)}),n.getTileKey=(e=>{let n=e.row,t=e.col;if(void 0!==c&&void 0!==c[n])return c[n][t]}),n.getTile=(e=>{let n=e.row,t=e.col;if(void 0!==l[n])return l[n][t]}),n.moveTile=((e,n)=>{let t,a=e.fromRow,r=e.fromCol,g=e.toRow,d=e.toCol,f=e.speed,u=e.accel;void 0===c[g]?c[g]=[]:t=c[g][d],void 0===c[a]?c[a]=[]:c[g][d]=c[a][r],c[a][r]=t;let S;void 0!==l[a]&&(S=l[a][r]);let s;void 0!==l[g]&&(s=l[g][d]),void 0!==S&&(void 0!==f||void 0!==u?(S.moveTo({x:d*i,y:g*o,speed:f,accel:u},n),n=void 0):S.setPosition({x:d*i,y:g*o})),void 0===l[g]&&(l[g]=[]),l[g][d]=S,void 0===s?void 0!==l[a]&&(l[a][r]=void 0):(void 0!==f||void 0!==u?(s.moveTo({x:r*i,y:a*o,speed:f,accel:u},n),n=void 0):s.setPosition({x:r*i,y:a*o}),void 0===l[a]&&(l[a]=[]),l[a][r]=s)}),n.removeTile=(e=>{let n=e.row,t=e.col;void 0!==c[n]&&(c[n][t]=void 0),void 0!==l[n]&&void 0!==l[n][t]&&(l[n][t].remove(),l[n][t]=void 0)});OVERRIDE(n.empty,e=>{r=n.empty=(()=>{c=[],l=[],e()})});let g=n.checkCollisionTile=(e=>{let n=e.row,t=e.col;return void 0!==l[n]&&void 0!==l[n][t]&&l[n][t].checkIsInstanceOf(SkyEngine.CollisionTile)===!0});n.findPath=(e=>{let n=e.startRow,t=e.startCol,i=e.endRow,o=e.endCol,a=[],c=[],r=(e,n,t)=>{if(g({row:n,col:t})===!0){void 0===a[n]&&(a[n]=[]);let i=e.cost+1;(void 0===a[n][t]||a[n][t]>i)&&(a[n][t]=i,c.push({parent:e,row:n,col:t,cost:i}))}};for(r({cost:-1},n,t);c.length>0;){let e=c.shift();if(e.row===i&&e.col===o){let n=[],t=e;for(;t.cost>=0;)n.unshift({row:t.row,col:t.col}),t=t.parent;return n}r(e,e.row-1,e.col),r(e,e.row,e.col+1),r(e,e.row+1,e.col),r(e,e.row,e.col-1)}})},afterInit:(e,n,t)=>{let i=t.tileMap,o=t.tileKeyMap;void 0!==i&&(EACH(i,(e,t)=>{EACH(e,(e,i)=>{void 0!==e&&n.addTile({row:t,col:i,tile:e})})}),i=void 0),void 0!==o&&EACH(o,(e,t)=>{EACH(e,(e,i)=>{n.addTile({row:t,col:i,key:e})})})}}),SkyEngine("Util").Collision=OBJECT({init:(e,n)=>{let t=(e,n,t)=>{return(n-e)*(t-e)<=0},i=n.checkPointInRect=((e,n,i,o,a,c,r,l,g,d)=>{e-=i,n-=o;let f=i+d*e+g*n,u=o-g*e+d*n;return a*=r,c*=l,i-=a/2,o-=c/2,t(f,i,i+a)===!0&&t(u,o,o+c)===!0}),o=n.checkPointInCircle=((e,n,t,i,o,a,c,r,l,g)=>{e-=t,n-=i,o*=c,a*=r;let d=2*(g*e+l*n)/o,f=2*(l*e-g*n)/a;return d*d+f*f<=1}),a=n.checkPointInPolygon=((e,n,t,i,o,a,c,r,l)=>{e-=t,n-=i;let g=t+l*e+r*n,d=i-r*e+l*n;g-=t,d-=i;let f=!1,u=o.length;for(let S=0,s=u-1;S<u;s=S,S+=1){let e=o[S].x*a,n=o[S].y*c,t=o[s].x*a,i=o[s].y*c;n>d!=i>d&&g<(t-e)*(d-n)/(i-n)+e&&(f=!f)}return f}),c=n.checkLineLine=((e,n,t,i,o,a,c,r,l,g,d,f,u,S,s,v,p,R,h,E)=>{t*=c,i*=r;let y=e+g*t+l*i,k=n+l*t+g*i;o*=c,a*=r;let m=e+g*o+l*a,C=n+l*o+g*a;u*=p,S*=R;let x=d+E*u+h*S,w=f+h*u+E*S;s*=p,v*=R;let Y=d+E*s+h*v,I=f+h*s+E*v,X=(m-y)*(I-w)-(Y-x)*(C-k);if(0===X)return!1;{let e=((I-w)*(Y-y)+(x-Y)*(I-k))/X,n=((k-C)*(Y-y)+(m-y)*(I-k))/X;return 0<=e&&e<=1&&0<=n&&n<=1}}),r=(n.checkLineRect=((e,n,t,o,a,r,l,g,d,f,u,S,s,v,p,R,h,E)=>{t*=l,o*=g;let y=e+f*t+d*o,k=n+d*t+f*o;if(i(y,k,u,S,s,v,p,R,h,E)===!0)return!0;a*=l,r*=g;let m=e+f*a+d*r,C=n+d*a+f*r;if(i(m,C,u,S,s,v,p,R,h,E)===!0)return!0;let x,w,Y,I,X,D,A,T;s*=p/2,v*=R/2;let P=E*s,O=E*v,M=-h*s,H=-h*v;return x=u-P-H,w=S+M-O,Y=u+P-H,I=S-M-O,X=u+P+H,D=S-M+O,A=u-P+H,T=S+M+O,c(0,0,y,k,m,C,1,1,0,1,0,0,x,w,Y,I,1,1,0,1)===!0||c(0,0,y,k,m,C,1,1,0,1,0,0,Y,I,X,D,1,1,0,1)===!0||c(0,0,y,k,m,C,1,1,0,1,0,0,X,D,A,T,1,1,0,1)===!0||c(0,0,y,k,m,C,1,1,0,1,0,0,A,T,x,w,1,1,0,1)===!0}),n.checkLineCircle=((e,n,i,a,c,l,g,d,f,u,S,s,v,p,R,h,E,y)=>{i*=g,a*=d;let k=e+u*i+f*a,m=n+f*i+u*a;if(o(k,m,S,s,v,p,R,h,E,y)===!0)return!0;c*=g,l*=d;let C=e+u*c+f*l,x=n+f*c+u*l;if(o(C,x,S,s,v,p,R,h,E,y)===!0)return!0;k-=S,m-=s,C-=S,x-=s;let w=y*k+E*m,Y=-E*k+y*m,I=y*C+E*x,X=-E*C+y*x;v*=R,p*=h;let D=(X-Y)/(I-w);if(Math.abs(D)>1024)return r(0,0,Y,w,X,I,1,1,0,1,0,0,p,v,1,1,0,1);if(o(I,X,0,0,v,p,1,1,0,1)===!0)return!0;let A=v*v/4,T=p*p/4,P=Y-D*w,O=1/A+D*D/T,M=2*D*P/T,H=P*P/T-1,F=M*M-4*O*H;return!(F<0)&&(F=Math.sqrt(F),O*=2,t((-M-F)/O,w,I)===!0||t((-M+F)/O,w,I)===!0)})),l=(n.checkLinePolygon=((e,n,t,i,o,r,l,g,d,f,u,S,s,v,p,R,h)=>{t*=l,i*=g;let E=e+f*t+d*i,y=n+d*t+f*i;if(a(E,y,u,S,s,v,p,R,h)===!0)return!0;o*=l,r*=g;let k=e+f*o+d*r,m=n+d*o+f*r;if(a(k,m,u,S,s,v,p,R,h)===!0)return!0;let C=s.length;for(let x=0,w=C-1;x<C;w=x,x+=1){let e=s[x].x*v,n=s[x].y*p,t=s[w].x*v,i=s[w].y*p,o=u+h*e-R*n,a=S+R*e+h*n,r=u+h*t-R*i,l=S+R*t+h*i;if(c(0,0,E,y,k,m,1,1,0,1,0,0,o,a,r,l,1,1,0,1)===!0)return!0}return!1}),n.checkRectRect=((e,n,t,o,a,r,l,g,d,f,u,S,s,v,p,R)=>{t*=a,o*=r,u*=s,S*=v;let h,E,y,k,m,C,x,w,Y=g*t/2,I=g*o/2,X=-l*t/2,D=-l*o/2;if(h=e-Y-D,E=n+X-I,y=e+Y-D,k=n-X-I,m=e+Y+D,C=n-X+I,x=e-Y+D,w=n+X+I,i(h,E,d,f,u,S,1,1,p,R)===!0||i(y,k,d,f,u,S,1,1,p,R)===!0||i(m,C,d,f,u,S,1,1,p,R)===!0||i(x,w,d,f,u,S,1,1,p,R)===!0)return!0;let A,T,P,O,M,H,F,W,L=R*u/2,N=R*S/2,V=-p*u/2,_=-p*S/2;return A=d-L-_,T=f+V-N,P=d+L-_,O=f-V-N,M=d+L+_,H=f-V+N,F=d-L+_,W=f+V+N,i(A,T,e,n,t,o,1,1,l,g)===!0||i(P,O,e,n,t,o,1,1,l,g)===!0||i(M,H,e,n,t,o,1,1,l,g)===!0||i(F,W,e,n,t,o,1,1,l,g)===!0||(c(0,0,h,E,y,k,1,1,0,1,0,0,A,T,P,O,1,1,0,1)===!0||c(0,0,h,E,y,k,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||c(0,0,h,E,y,k,1,1,0,1,0,0,M,H,F,W,1,1,0,1)===!0||c(0,0,h,E,y,k,1,1,0,1,0,0,F,W,A,T,1,1,0,1)===!0||c(0,0,y,k,m,C,1,1,0,1,0,0,A,T,P,O,1,1,0,1)===!0||c(0,0,y,k,m,C,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||c(0,0,y,k,m,C,1,1,0,1,0,0,M,H,F,W,1,1,0,1)===!0||c(0,0,y,k,m,C,1,1,0,1,0,0,F,W,A,T,1,1,0,1)===!0||c(0,0,m,C,x,w,1,1,0,1,0,0,A,T,P,O,1,1,0,1)===!0||c(0,0,m,C,x,w,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||c(0,0,m,C,x,w,1,1,0,1,0,0,M,H,F,W,1,1,0,1)===!0||c(0,0,m,C,x,w,1,1,0,1,0,0,F,W,A,T,1,1,0,1)===!0||c(0,0,x,w,h,E,1,1,0,1,0,0,A,T,P,O,1,1,0,1)===!0||c(0,0,x,w,h,E,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||c(0,0,x,w,h,E,1,1,0,1,0,0,M,H,F,W,1,1,0,1)===!0||c(0,0,x,w,h,E,1,1,0,1,0,0,F,W,A,T,1,1,0,1)===!0)}),n.checkRectCircle=((e,n,t,a,c,l,g,d,f,u,S,s,v,p,R,h)=>{if(i(f,u,e,n,t,a,c,l,g,d)===!0)return!0;let E,y,k,m,C,x,w,Y;t*=c/2,a*=l/2;let I=d*t,X=d*a,D=-g*t,A=-g*a;return E=e-I-A,y=n+D-X,k=e+I-A,m=n-D-X,C=e+I+A,x=n-D+X,w=e-I+A,Y=n+D+X,o(E,y,f,u,S,s,v,p,R,h)===!0||o(k,m,f,u,S,s,v,p,R,h)===!0||o(C,x,f,u,S,s,v,p,R,h)===!0||o(w,Y,f,u,S,s,v,p,R,h)===!0||(S*=v,s*=p,r(0,0,E,y,k,m,1,1,0,1,f,u,S,s,1,1,R,h)===!0||r(0,0,k,m,C,x,1,1,0,1,f,u,S,s,1,1,R,h)===!0||r(0,0,C,x,w,Y,1,1,0,1,f,u,S,s,1,1,R,h)===!0||r(0,0,w,Y,E,y,1,1,0,1,f,u,S,s,1,1,R,h)===!0)}),n.checkRectPolygon=((e,n,t,o,r,l,g,d,f,u,S,s,v,p,R)=>{t*=r,o*=l;let h,E,y,k,m,C,x,w,Y=d*t/2,I=d*o/2,X=-g*t/2,D=-g*o/2;if(h=e-Y-D,E=n+X-I,y=e+Y-D,k=n-X-I,m=e+Y+D,C=n-X+I,x=e-Y+D,w=n+X+I,a(h,E,f,u,S,s,v,p,R)===!0||a(y,k,f,u,S,s,v,p,R)===!0||a(m,C,f,u,S,s,v,p,R)===!0||a(x,w,f,u,S,s,v,p,R)===!0)return!0;let A=S.length;for(let T=0,P=A-1;T<A;P=T,T+=1){let a=S[T].x*s,r=S[T].y*v,l=f+R*a-p*r,Y=u+p*a+R*r;if(i(l,Y,e,n,t,o,1,1,g,d)===!0)return!0;let I=S[P].x*s,X=S[P].y*v,D=f+R*I-p*X,A=u+p*I+R*X;if(c(0,0,h,E,y,k,1,1,0,1,0,0,l,Y,D,A,1,1,0,1)===!0||c(0,0,y,k,m,C,1,1,0,1,0,0,l,Y,D,A,1,1,0,1)===!0||c(0,0,m,C,x,w,1,1,0,1,0,0,l,Y,D,A,1,1,0,1)===!0||c(0,0,x,w,h,E,1,1,0,1,0,0,l,Y,D,A,1,1,0,1)===!0)return!0}return!1}),(e,n,t,i,o)=>{if(0===o)return!0;if(0===e)return 0!==n||(0!==t?i*i-4*t*o>=0:0!==i);let a=n/e,c=t/e,r=i/e,l=o/e,g=(8*c-3*a*a)/8,d=(a*a*a-4*a*c+8*r)/8,f=(-3*a*a*a*a+256*l-64*r*a+16*a*a*c)/256,u=256*f*f*f-128*g*g*f*f+144*g*d*d*f-27*d*d*d*d+16*g*g*g*g*f-4*g*g*g*d*d,S=8*g,s=64*f-16*g*g;return u<0||u>0&&S<0&&s<0||0===u&&(0!==s||S<=0)}),g=(e,n,t,i,o,a,c,r,g,d,f,u)=>{let S=(r/=c)-(n/=e),s=(g/=c)-(t/=e),v=(d/=c)-(i/=e),p=(f/=c)-(o/=e),R=(u/=c)-(a/=e);if(0===S&&0===v)return l(0,0,s,p,R);let h=n*g-r*t,E=n*f+i*g-r*o-d*t,y=n*u+i*f-r*a-d*o,k=i*u-d*a,m=s*s-h*S,C=2*s*p-S*E-v*h,x=p*p+2*s*R-S*y-v*E,w=2*p*R-v*y-S*k,Y=R*R-v*k;return l(m,C,x,w,Y)};n.checkCircleCircle=((e,n,t,i,a,c,r,l,d,f,u,S,s,v,p,R)=>{t*=a,i*=c,u*=s,S*=v,d-=e,f-=n,e=n=0;let h=((t>i?t:i)+(u>S?u:S))/2;if(d*d+f*f>h*h)return!1;if(o(d,f,e,n,t,i,1,1,r,l)===!0||o(e,n,d,f,u,S,1,1,p,R)===!0)return!0;let E=l*e+r*n,y=-r*e+l*n;r=-r;let k=t*t/4,m=i*i/4,C=l*l/k+r*r/m,x=-2*l*r/k+2*l*r/m,w=r*r/k+l*l/m,Y=-2*E*l/k-2*y*r/m,I=2*E*r/k-2*y*l/m,X=E*E/k+y*y/m-1;E=R*d+p*f,y=-p*d+R*f,p=-p,k=u*u/4,m=S*S/4;let D=R*R/k+p*p/m,A=-2*R*p/k+2*R*p/m,T=p*p/k+R*R/m,P=-2*E*R/k-2*y*p/m,O=2*E*p/k-2*y*R/m,M=E*E/k+y*y/m-1;return g(C,x,w,Y,I,X,D,A,T,P,O,M)&&g(w,x,C,I,Y,X,T,A,D,O,P,M)}),n.checkCirclePolygon=((e,n,t,i,c,l,g,d,f,u,S,s,v,p,R)=>{if(a(e,n,f,u,S,s,v,p,R)===!0)return!0;t*=c,i*=l;let h=S.length;for(let E=0,y=h-1;E<h;y=E,E+=1){let a=S[E].x*s,c=S[E].y*v,l=f+R*a-p*c,h=u+p*a+R*c;if(o(l,h,e,n,t,i,1,1,g,d)===!0)return!0;let k=S[y].x*s,m=S[y].y*v,C=f+R*k-p*m,x=u+p*k+R*m;if(r(0,0,l,h,C,x,1,1,0,1,e,n,t,i,1,1,g,d)===!0)return!0}return!1}),n.checkPolygonPolygon=((e,n,t,i,o,r,l,g,d,f,u,S,s,v)=>{let p=t.length,R=f.length;for(let h=0,E=R-1;h<R;E=h,h+=1){let c=f[h].x*u,p=f[h].y*S,R=g+v*c-s*p,E=d+s*c+v*p;if(a(R,E,e,n,t,i,o,r,l)===!0)return!0}for(let h=0,E=p-1;h<p;E=h,h+=1){let p=t[h].x*i,y=t[h].y*o,k=e+l*p-r*y,m=n+r*p+l*y;if(a(k,m,g,d,f,u,S,s,v)===!0)return!0;let C=t[E].x*i,x=t[E].y*o,w=e+l*C-r*x,Y=n+r*C+l*x;for(let I=0,X=R-1;I<R;X=I,I+=1){let e=f[I].x*u,n=f[I].y*S,t=g+v*e-s*n,i=d+s*e+v*n,o=f[X].x*u,a=f[X].y*S,r=g+v*o-s*a,l=d+s*o+v*a;if(c(0,0,k,m,w,Y,1,1,0,1,0,0,t,i,r,l,1,1,0,1)===!0)return!0}}return!1})}}),SkyEngine("Util").ImageData=OBJECT({init:(e,n)=>{const t=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1],i=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0];let o=n.checkImageDataPointIsTransparent=((e,n,t,i)=>{return e[4*(i*n+t)+3]<=20});n.convertImageDataToPolygonPoints=((e,n)=>{let a,c,r,l,g=0,d=0,f=[];for(;;){if(o(e,n,g,d)!==!0){r=g,l=d;break}0===g?(g=d+1,d=0):(g-=1,d+=1)}g=r,d=l;let u=0,S=0;do{let r=0;if(o(e,n,g-1,d-1)!==!0&&(r+=1),o(e,n,g,d-1)!==!0&&(r+=2),o(e,n,g-1,d)!==!0&&(r+=4),o(e,n,g,d)!==!0&&(r+=8),6===r)u=c===-1?-1:1,S=0;else if(9===r)u=0,S=1===a?-1:1;else{if(!(r<15))break;u=t[r],S=i[r]}if(u!==a&&S!==c&&(f.push({x:g,y:d}),a=u,c=S),g+=u,d+=S,g<0||d<0)break}while(r!==g||l!==d);return f})}});